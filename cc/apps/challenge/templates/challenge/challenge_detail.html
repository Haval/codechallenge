{% extends 'base.html' %}

{% block contents %}

	<header>
		<h1>
			{% if is_owner %}
				<span onclick="Edit(this);">{{ challenge.name }}</span>
				<input data-input type="text" rel="name" value="{{ challenge.name }}" style="display:none;" />
			{% else %}
				{{ challenge.name }}
			{% endif %}
			<small>
				{% if user.is_authenticated %}
					{% if participant %}
					<a title="Leave this challenge" href="{% url 'challenge:leave' challenge.id %}"><i class="fa fa-sign-out"></i></a>
					{% else %}
					<a title="Join this challenge" href="{% url 'challenge:join' challenge.id %}"><i class="fa fa-ticket"></i></a>
					{% endif %}
				{% endif %}
			</small>
			<small>{{ challenge.duration }} day{{challenge.duration|pluralize}}</small>
		</h1>
	</header>

	{% include 'challenge/stats.html' with challenge=challenge participant=participant %}

	{% include 'challenge/participants.html' with challenge=challenge %}

	{% include 'challenge/rules.html' with challenge=challenge %}

	{% include 'challenge/entries.html' with challenge=challenge participant=participant %}

	{% include 'challenge/challenge_comments.html' with challenge=challenge can_comment=can_comment %}

{% endblock %}

{% block extrascripts %}

<script type="text/javascript">
	function Edit(elt) {
		var $elt = $(elt);
		$elt.hide();

		var $input = $elt.siblings('[data-input]');
		$input.show().focus().keydown(function(e) {
			if (e.which == 13) {

				var postData = {
					csrfmiddlewaretoken: '{{ csrf_token }}',
					name: $(this).attr('rel'),
					value: $(this).val()
				};

				$.post('/challenge/{{ challenge.id }}/update', postData, function(data) {
					console.log(data);
				});
			}
		});
	}

	$('[title]').tooltip({delay:{show:1000,hide:0}});
</script>

{% endblock %}