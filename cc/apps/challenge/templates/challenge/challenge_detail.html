{% extends 'base.html' %}

{% block contents %}

	<aside id="participant_info" class="pull-right">
		<h3>Stats</h3>
		<ul class="list-unstyled">
			<li>{{ challenge.owner.webname }} is the owner</li>
			{% if participant %}
			<li>You've been working on this challenge since <strong>{{ participant.date_joined }}</strong></li>
			<li>This challenge ends on <strong>{{ participant.end_date }}</strong> for you</li>
			<li>
				<div class="progress">
					<div class="progress-bar" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="100" style="width: {{ participant.percent_complete }}%">
						<span>{{ participant.days_left|floatformat:2 }} days left</span>
					</div>
				</div>
			</li>
			{% endif %}
		</ul>
	</aside>
	<header>
		<h1>
			{% if is_owner %}
				<span onclick="Edit(this);">{{ challenge.name }}</span>
				<input data-input type="text" rel="name" value="{{ challenge.name }}" style="display:none;" />
			{% else %}
				{{ challenge.name }}
			{% endif %}
		</h1>
	</header>

	{% if user.is_authenticated %}
		{% if participant %}
		<a class="btn btn-primary btn-lg" href="{% url 'challenge:leave' challenge.id %}">Leave this challenge</a>
		{% else %}
		<a class="btn btn-primary btn-lg" href="{% url 'challenge:join' challenge.id %}">Join this challenge</a>
		{% endif %}
	{% endif %}

	{% if challenge.partcipant_set.count > 0 %}
	<h3>Coders on this challenge</h3>
	<ul>
		{% for participant in challenge.partcipant_set.all %}
		<li><a href="{% url 'coder:profile' participant.coder.user.username %}">{{participant.coder.webname}}</a></li>
		{% endfor %}
	</ul>
	{% endif %}

	<h3>Rules</h3>

	<ul>
	{% for rule in challenge.rule_set.all %}
		<li>{{ rule }}</li>
	{% endfor %}
	</ul>

{% endblock %}

{% block extrascripts %}

<script type="text/javascript">
	function Edit(elt) {
		var $elt = $(elt);
		$elt.hide();

		var $input = $elt.siblings('[data-input]');
		$input.show().focus().keydown(function(e) {
			if (e.which == 13) {
				
				var postData = {
					csrfmiddlewaretoken: '{{ csrf_token }}',
					name: $(this).attr('rel'),
					value: $(this).val()
				};

				$.post('/challenge/{{ challenge.id }}/update', postData, function(data) {
					console.log(data);
				});
			}
		});
	}
</script>

{% endblock %}